{"remainingRequest":"/Users/sorens/Documents/GitHub/vfde-inv-var-ui-demo/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/sorens/Documents/GitHub/vfde-inv-var-ui-demo/src/components/dashboard/aws/FileExplorer.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/sorens/Documents/GitHub/vfde-inv-var-ui-demo/src/components/dashboard/aws/FileExplorer.vue","mtime":1639653885442},{"path":"/Users/sorens/Documents/GitHub/vfde-inv-var-ui-demo/node_modules/cache-loader/dist/cjs.js","mtime":1639655034192},{"path":"/Users/sorens/Documents/GitHub/vfde-inv-var-ui-demo/node_modules/babel-loader/lib/index.js","mtime":1639655034093},{"path":"/Users/sorens/Documents/GitHub/vfde-inv-var-ui-demo/node_modules/cache-loader/dist/cjs.js","mtime":1639655034192},{"path":"/Users/sorens/Documents/GitHub/vfde-inv-var-ui-demo/node_modules/vue-loader/lib/index.js","mtime":1639655080628}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCgppbXBvcnQgbW9tZW50IGZyb20gIm1vbWVudC10aW1lem9uZSIKaW1wb3J0IExvYWRpbmcgZnJvbSAiQC9jb21wb25lbnRzL0xvYWRpbmciOwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJGaWxlRXhwbG9yZXIiLAogIGNvbXBvbmVudHM6IHtMb2FkaW5nfSwKICBtb3VudGVkKCkgewogICAgaWYgKCF0aGlzLmVudmlyb25tZW50RXJyb3IpIHsKICAgICAgdGhpcy5hd3MuY29uZmlnLnVwZGF0ZSgKICAgICAgICAgIHsKICAgICAgICAgICAgcmVnaW9uOiB0aGlzLmV4cGxvcmVyQ29uZmlnLnJlZ2lvbiwKICAgICAgICAgICAgYWNjZXNzS2V5SWQ6IHRoaXMuZXhwbG9yZXJDb25maWcuYWNjZXNzS2V5LAogICAgICAgICAgICBzZWNyZXRBY2Nlc3NLZXk6IHRoaXMuZXhwbG9yZXJDb25maWcuc2VjcmV0S2V5LAogICAgICAgICAgICBjb3JyZWN0Q2xvY2tTa2V3OiB0cnVlLAogICAgICAgICAgICBzaWduYXR1cmVWZXJzaW9uOiAndjQnCiAgICAgICAgICB9CiAgICAgICk7CiAgICAgIHRoaXMuczMgPSBuZXcgdGhpcy5hd3MuUzMoe2FwaVZlcnNpb246IHRoaXMuZXhwbG9yZXJDb25maWcuYXBpfSk7CiAgICAgIHRoaXMudXBkYXRlRXhwbG9yZXJGcm9tUm91dGUoKQogICAgfSBlbHNlIHsKICAgICAgY29uc29sZS5sb2coIkVudmlyb25tZW50IGVycm9yOiBBcmUgeW91ciBlbnZpcm9ubWVudCB2YXJpYWJsZXMgc2V0IHVwIGNvcnJlY3RseT8iKQogICAgfQoKICB9LAogIGRhdGEoKSB7CiAgICB0cnkgewogICAgICByZXR1cm4gewogICAgICAgIGF3czogcmVxdWlyZSgnYXdzLXNkaycpLAogICAgICAgIGN1cnJlbnRQYWdlOjEsCiAgICAgICAgcGVyUGFnZToyNSwKICAgICAgICB1cGxvYWRlZDogW10sCiAgICAgICAgZmlsZXNVcGxvYWRlZDogMCwKICAgICAgICBsb2FkaW5nOiB0cnVlLAogICAgICAgIHByb2dyZXNzQmFyS2V5OiB0aGlzLnJhbmRvbUtleSgpLAogICAgICAgIHVwbG9hZGVkRmllbGRzOiBbCiAgICAgICAgICAnbmFtZScsCiAgICAgICAgICAncHJvZ3Jlc3MnLAogICAgICAgICAgJ3N0YXR1cycKICAgICAgICBdLAogICAgICAgIGZvbGRlckV4aXN0czogZmFsc2UsCiAgICAgICAgdXBsb2FkaW5nOiBmYWxzZSwKICAgICAgICBleHBsb3JlckNvbmZpZzogewogICAgICAgICAgYWNjZXNzS2V5OiBwcm9jZXNzLmVudi5WVUVfQVBQX1MzX0FDQ0VTU19LRVksCiAgICAgICAgICBzZWNyZXRLZXk6IHByb2Nlc3MuZW52LlZVRV9BUFBfUzNfU0VDUkVUX0tFWSwKICAgICAgICAgIHByZWZpeDogcHJvY2Vzcy5lbnYuVlVFX0FQUF9TM19ERUZBVUxUX0ZPTERFUiwKICAgICAgICAgIGhvbWU6IHByb2Nlc3MuZW52LlZVRV9BUFBfUzNfREVGQVVMVF9GT0xERVIucmVwbGFjZSgnLycsICcnKSwKICAgICAgICAgIGJ1Y2tldDogcHJvY2Vzcy5lbnYuVlVFX0FQUF9TM19CVUNLRVQsCiAgICAgICAgICByZWdpb246IHByb2Nlc3MuZW52LlZVRV9BUFBfUzNfUkVHSU9OLAogICAgICAgICAgYXBpOiBwcm9jZXNzLmVudi5WVUVfQVBQX1MzX0FQSV9WRVJTSU9OLAogICAgICAgICAgZmllbGRzOiBbCiAgICAgICAgICAgICdzZWxlY3RlZCcsCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBrZXk6ICd0eXBlJywKICAgICAgICAgICAgICBzb3J0YWJsZTogdHJ1ZSwKICAgICAgICAgICAgICBzb3J0QnlGb3JtYXR0ZWQ6IHRydWUsCiAgICAgICAgICAgICAgZm9ybWF0dGVyOiAodmFsdWUpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVUeXBlID0gdmFsdWUudG9Mb3dlckNhc2UoKQogICAgICAgICAgICAgICAgbGV0IGljb24KICAgICAgICAgICAgICAgIHN3aXRjaCAoZmlsZVR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAvLyBGb2xkZXIKICAgICAgICAgICAgICAgICAgY2FzZSAnZm9sZGVyJzoKICAgICAgICAgICAgICAgICAgICBpY29uID0gJ2ZvbGRlci1vcGVuJwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIC8vICBBdWRpbyBmb3JtYXRzCiAgICAgICAgICAgICAgICAgIGNhc2UgJ200YSc6CiAgICAgICAgICAgICAgICAgIGNhc2UgJ2ZsYWMnOgogICAgICAgICAgICAgICAgICBjYXNlICdtcDMnOgogICAgICAgICAgICAgICAgICBjYXNlICd3YXYnOgogICAgICAgICAgICAgICAgICBjYXNlICd3bWEnOgogICAgICAgICAgICAgICAgICBjYXNlICdhYWMnOgogICAgICAgICAgICAgICAgICAgIGljb24gPSAnZmlsZS1hdWRpbycKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIC8vICBWaWRlbyBmb3JtYXRzCiAgICAgICAgICAgICAgICAgIGNhc2UgJ21wNCc6CiAgICAgICAgICAgICAgICAgIGNhc2UgJ21vdic6CiAgICAgICAgICAgICAgICAgIGNhc2UgJ3dtdic6CiAgICAgICAgICAgICAgICAgIGNhc2UgJ2F2aSc6CiAgICAgICAgICAgICAgICAgIGNhc2UgJ2F2Y2hkJzoKICAgICAgICAgICAgICAgICAgY2FzZSAnZmx2JzoKICAgICAgICAgICAgICAgICAgY2FzZSAnZjR2JzoKICAgICAgICAgICAgICAgICAgY2FzZSAnc3dmJzoKICAgICAgICAgICAgICAgICAgY2FzZSAnd2VibSc6CiAgICAgICAgICAgICAgICAgIGNhc2UgJ21wZWctMic6CiAgICAgICAgICAgICAgICAgICAgaWNvbiA9ICdmaWxlLXZpZGVvJwogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgLy8gQXJjaGl2ZSBmb3JtYXRzCiAgICAgICAgICAgICAgICAgIGNhc2UgJ3ppcCc6CiAgICAgICAgICAgICAgICAgIGNhc2UgJ3Jhcic6CiAgICAgICAgICAgICAgICAgIGNhc2UgJ2d6JzoKICAgICAgICAgICAgICAgICAgY2FzZSAnN3onOgogICAgICAgICAgICAgICAgICAgIGljb24gPSAnZmlsZS1hcmNoaXZlJwogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgLy8gSW1hZ2UgZm9ybWF0cwogICAgICAgICAgICAgICAgICBjYXNlICdnaWYnOgogICAgICAgICAgICAgICAgICBjYXNlICdqcGcnOgogICAgICAgICAgICAgICAgICBjYXNlICdqcGVnJzoKICAgICAgICAgICAgICAgICAgY2FzZSAnc3ZnJzoKICAgICAgICAgICAgICAgICAgY2FzZSAnYm1wJzoKICAgICAgICAgICAgICAgICAgY2FzZSAncG5nJzoKICAgICAgICAgICAgICAgICAgY2FzZSAncHNkJzoKICAgICAgICAgICAgICAgICAgY2FzZSAnYWknOgogICAgICAgICAgICAgICAgICAgIGljb24gPSAnZmlsZS1pbWFnZScKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIC8vIEV4Y2VsCiAgICAgICAgICAgICAgICAgIGNhc2UgJ3hscyc6CiAgICAgICAgICAgICAgICAgIGNhc2UgJ3hsc3gnOgogICAgICAgICAgICAgICAgICAgIGljb24gPSAnZmlsZS1leGNlbCcKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIC8vIFdvcmQKICAgICAgICAgICAgICAgICAgY2FzZSAnZG9jJzoKICAgICAgICAgICAgICAgICAgY2FzZSAnZG9jeCc6CiAgICAgICAgICAgICAgICAgICAgaWNvbiA9ICdmaWxlLXdvcmQnCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAvLyBQb3dlcnBvaW50CiAgICAgICAgICAgICAgICAgIGNhc2UgJ3BwdCc6CiAgICAgICAgICAgICAgICAgIGNhc2UgJ3BwdHgnOgogICAgICAgICAgICAgICAgICAgIGljb24gPSAnZmlsZS1wb3dlcnBvaW50JwogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgLy8gQ1NWCiAgICAgICAgICAgICAgICAgIGNhc2UgJ2Nzdic6CiAgICAgICAgICAgICAgICAgICAgaWNvbiA9ICdmaWxlLWNzdicKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIC8vIFBERgogICAgICAgICAgICAgICAgICBjYXNlICdwZGYnOgogICAgICAgICAgICAgICAgICAgIGljb24gPSAnZmlsZS1wZGYnCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAvLyBUZXh0IGZpbGUKICAgICAgICAgICAgICAgICAgY2FzZSAndHh0JzoKICAgICAgICAgICAgICAgICAgICBpY29uID0gJ2ZpbGUtYWx0JwogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgbm8gbWF0Y2ggZGVmYXVsdCB0byBhIGJsYW5rIGZpbGUgaWNvbgogICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIGljb24gPSAnZmlsZScKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBpY29uCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAga2V5OiAnTmFtZScsCiAgICAgICAgICAgICAgc29ydGFibGU6IHRydWUsCiAgICAgICAgICAgICAgdGRDbGFzczogJ3RleHQtbGVmdCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIGtleTogJ0xhc3RNb2RpZmllZCcsCiAgICAgICAgICAgICAgc29ydGFibGU6IHRydWUsCiAgICAgICAgICAgICAgZm9ybWF0dGVyOiAodmFsdWUpID0+IHsKICAgICAgICAgICAgICAgIHJldHVybiBtb21lbnQodmFsdWUpLnR6KHRoaXMudGltZVpvbmUpLmZvcm1hdCgiREQvTU0vWVlZWSBISDptbTpzcyIpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAga2V5OiAnU2l6ZScsCiAgICAgICAgICAgICAgc29ydGFibGU6IHRydWUsCiAgICAgICAgICAgICAgZm9ybWF0dGVyOiAodmFsdWUpID0+IHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmh1bWFuRmlsZVNpemUodmFsdWUpCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0KICAgICAgICB9LAogICAgICAgIHRpbWVab25lOiBJbnRsLkRhdGVUaW1lRm9ybWF0KCkucmVzb2x2ZWRPcHRpb25zKCkudGltZVpvbmUsCiAgICAgICAgczNPYmplY3RzOiBbXSwKICAgICAgICBzMzogbnVsbCwKICAgICAgICB0YWJsZURhdGE6IFtdLAogICAgICAgIGJyZWFkY3J1bWJzOiBbXSwKICAgICAgICBuZXdGb2xkZXJOYW1lOiAiIiwKICAgICAgICBmaWxlc1RvRGVsZXRlOiBbXSwKICAgICAgICBmaWxlc1RvVXBsb2FkOiBbXSwKICAgICAgICBmb2xkZXJzVG9EZWxldGU6IFtdLAogICAgICAgIGZpbHRlcjogIiIsCiAgICAgICAgZG93bmxvYWRlZDogMCwKICAgICAgICBicmVhZGNydW1iS2V5OiB0aGlzLnJhbmRvbUtleSgpLAogICAgICAgIGVudmlyb25tZW50RXJyb3I6IGZhbHNlCiAgICAgIH0KICAgIH0KICAgIGNhdGNoIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBlbnZpcm9ubWVudEVycm9yOiB0cnVlCiAgICAgIH0KICAgIH0KICB9LAogIGNvbXB1dGVkOiB7CiAgICByb3dzKCkgewogICAgICByZXR1cm4gdGhpcy50YWJsZURhdGEubGVuZ3RoCiAgICB9LAogICAgYnJlYWRjcnVtYkNsYXNzKCkgewogICAgICBpZiAodGhpcy5mb2xkZXJFeGlzdHMpIHsKICAgICAgICByZXR1cm4gImJyZWFkY3J1bWItaXRlbSIKICAgICAgfQogICAgICByZXR1cm4gIiIKICAgIH0KICB9LAogIHdhdGNoOiB7CiAgICAkcm91dGUoKSB7CiAgICAgIHRoaXMudXBkYXRlRXhwbG9yZXJGcm9tUm91dGUoKQogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgcmVmcmVzaCgpIHsKICAgICAgdGhpcy5nZXRPYmplY3RzKHRoaXMuZXhwbG9yZXJDb25maWcucHJlZml4KQogICAgfSwKICAgIHVwZGF0ZUV4cGxvcmVyRnJvbVJvdXRlKCkgewogICAgICBsZXQgZm9sZGVyUGF0aCA9IHRoaXMuJHJvdXRlLnBhdGgucmVwbGFjZSgnL2F3cycsJycpCiAgICAgIGxldCBmdWxsUGF0aCA9IHRoaXMuZXhwbG9yZXJDb25maWcuaG9tZSAgKyBmb2xkZXJQYXRoCiAgICAgIGlmIChmdWxsUGF0aC5zdWJzdHIoLTEpICE9ICIvIikgewogICAgICAgIGZ1bGxQYXRoKz0iLyIKICAgICAgfQogICAgICB0aGlzLmV4cGxvcmVyQ29uZmlnLnByZWZpeCA9IGZ1bGxQYXRoCiAgICAgIHRoaXMuZ2V0T2JqZWN0cyh0aGlzLmV4cGxvcmVyQ29uZmlnLnByZWZpeCkKICAgIH0sCiAgICBpc0hvbWUoYnJlYWRjcnVtYikgewogICAgICByZXR1cm4gYnJlYWRjcnVtYiA9PT0gdGhpcy5leHBsb3JlckNvbmZpZy5ob21lCiAgICB9LAogICAgcmFuZG9tS2V5KG1pbiA9IDEsIG1heCA9IDEwMDApIHsgLy8gbWluIGFuZCBtYXggaW5jbHVkZWQKICAgICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSArIG1pbikKICAgIH0sCiAgICBzaG93RGVsZXRlTW9kYWwoKSB7CiAgICAgIHRoaXMuZmlsZXNUb0RlbGV0ZSA9IFtdCiAgICAgIGZvciAobGV0IGk9MDsgaTx0aGlzLnRhYmxlRGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGN1cnJlbnRJdGVtID0gdGhpcy50YWJsZURhdGFbaV0KICAgICAgICBpZiAoY3VycmVudEl0ZW0uc2VsZWN0ZWQpIHsKICAgICAgICAgIHRoaXMuZmlsZXNUb0RlbGV0ZS5wdXNoKGN1cnJlbnRJdGVtKQogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLiRyZWZzWydkZWxldGUtbW9kYWwnXS5zaG93KCkKICAgIH0sCiAgICBzaG93VXBsb2FkTW9kYWwoKSB7CiAgICAgIHRoaXMuZmlsZXNUb1VwbG9hZCA9IFtdCiAgICAgIHRoaXMuJHJlZnNbJ3VwbG9hZC1tb2RhbCddLnNob3coKQogICAgfSwKICAgIHNob3dOZXdGb2xkZXJNb2RhbCgpIHsKICAgICAgdGhpcy5maWxlc1RvVXBsb2FkID0gW10KICAgICAgdGhpcy4kcmVmc1snY3JlYXRlLWZvbGRlci1tb2RhbCddLnNob3coKQogICAgfSwKICAgIG9wZW5PYmplY3QoaXRlbSwgZXZlbnQpIHsKICAgICAgaWYodGhpcy5pc0ZvbGRlcihpdGVtKSkgewogICAgICAgIHRoaXMub3BlbkZvbGRlcihpdGVtLktleSkKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBwbGFjZWhvbGRlciA9IGV2ZW50LnRhcmdldAogICAgICAgIGNvbnN0IGRvd25sb2FkSW5mb3JtYXRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKQogICAgICAgIGRvd25sb2FkSW5mb3JtYXRpb24uaW5uZXJIVE1MID0gIlByZXBhcmluZyBkb3dubG9hZCBvZiAiICsgZXZlbnQudGFyZ2V0LnRleHQgKyAiPHNwYW4+KDAvMCk8L3NwYW4+IgogICAgICAgIGV2ZW50LnRhcmdldC5yZXBsYWNlV2l0aChkb3dubG9hZEluZm9ybWF0aW9uKQogICAgICAgIHRoaXMub3BlbkZpbGUoaXRlbSwgcGxhY2Vob2xkZXIsIGRvd25sb2FkSW5mb3JtYXRpb24pCiAgICAgIH0KICAgIH0sCiAgICBvcGVuRm9sZGVyKGZvbGRlcikgewogICAgICBjb25zdCBuZXdSb3V0ZSA9IGZvbGRlci5yZXBsYWNlKHRoaXMuZXhwbG9yZXJDb25maWcuaG9tZSwgJy9hd3MnKQogICAgICB0aGlzLiRyb3V0ZXIucHVzaChuZXdSb3V0ZSk7CiAgICB9LAogICAgb3BlbkZpbGUoaXRlbSwgcGxhY2Vob2xkZXIsIGRvd25sb2FkSW5mb3JtYXRpb24pIHsKICAgICAgY29uc3QgdHJhY2tlciA9IGRvd25sb2FkSW5mb3JtYXRpb24uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NwYW4nKVswXQogICAgICBjb25zdCBjb21wb25lbnQgPSB0aGlzCiAgICAgIHRyYWNrZXIuaW5uZXJIVE1MID0gYCgwLyR7Y29tcG9uZW50Lmh1bWFuRmlsZVNpemUoaXRlbS5TaXplKX0pYAogICAgICB0aGlzLnMzLmdldE9iamVjdCgKICAgICAgICAgIHsgQnVja2V0OiBjb21wb25lbnQuZXhwbG9yZXJDb25maWcuYnVja2V0LCBLZXk6IGl0ZW0uS2V5IH0sCiAgICAgICAgICBmdW5jdGlvbiAoZXJyb3IsIGRhdGEpIHsKICAgICAgICAgICAgaWYgKGVycm9yICE9IG51bGwpIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcikKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2RhdGEuQm9keV0sIHt0eXBlOiBgJHtkYXRhLkNvbnRlbnRUeXBlfWB9KQogICAgICAgICAgICAgIGNvbnN0IGZpbGVVUkwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsKICAgICAgICAgICAgICBjb25zdCBmaWxlTGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgICAgICAgICBmaWxlTGluay50ZXh0ID0gIkRvd25sb2FkIGFnYWluIgogICAgICAgICAgICAgIGZpbGVMaW5rLmhyZWYgPSBmaWxlVVJMOwogICAgICAgICAgICAgIGZpbGVMaW5rLnNldEF0dHJpYnV0ZSgnZG93bmxvYWQnLCBpdGVtLk5hbWUpOwogICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZmlsZUxpbmspOwogICAgICAgICAgICAgIGRvd25sb2FkSW5mb3JtYXRpb24ucmVwbGFjZVdpdGgocGxhY2Vob2xkZXIpCiAgICAgICAgICAgICAgZG93bmxvYWRJbmZvcm1hdGlvbi5hcHBlbmRDaGlsZChmaWxlTGluaykKICAgICAgICAgICAgICBmaWxlTGluay5jbGljaygpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICkub24oJ2h0dHBEb3dubG9hZFByb2dyZXNzJywgZnVuY3Rpb24ocHJvZ3Jlc3MpewogICAgICAgIGNvbnNvbGUubG9nKHByb2dyZXNzKQogICAgICAgIHRyYWNrZXIuaW5uZXJIVE1MID0gYCgke2NvbXBvbmVudC5odW1hbkZpbGVTaXplKHByb2dyZXNzLmxvYWRlZCl9LyR7Y29tcG9uZW50Lmh1bWFuRmlsZVNpemUocHJvZ3Jlc3MudG90YWwpfSlgCiAgICAgIH0pOwogICAgfSwKICAgIGRlbGV0ZUZpbGVzKCkgewogICAgICBjb25zdCBjb21wb25lbnQgPSB0aGlzCiAgICAgIGxldCBkZWxldGVGaWxlc1Byb21pc2UgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlRGVsZXRlLCByZWplY3REZWxldGUpIHsKICAgICAgICBsZXQgZGVsZXRlZEZpbGVzCiAgICAgICAgbGV0IG51bWJlck9mRmlsZXMgPSBjb21wb25lbnQuZmlsZXNUb0RlbGV0ZS5sZW5ndGgKICAgICAgICBjb21wb25lbnQuZm9sZGVyc1RvRGVsZXRlID0gW10KICAgICAgICBmb3IoZGVsZXRlZEZpbGVzPTA7IGRlbGV0ZWRGaWxlczxudW1iZXJPZkZpbGVzOyBkZWxldGVkRmlsZXMrKykgewogICAgICAgICAgY29tcG9uZW50LmRlbGV0ZUZpbGUoY29tcG9uZW50LmZpbGVzVG9EZWxldGVbZGVsZXRlZEZpbGVzXSkKICAgICAgICB9CiAgICAgICAgaWYgKGRlbGV0ZWRGaWxlcyA9PT0gbnVtYmVyT2ZGaWxlcykgewogICAgICAgICAgcmVzb2x2ZURlbGV0ZShudW1iZXJPZkZpbGVzICsgIiBmaWxlcyBkZWxldGVkIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlamVjdERlbGV0ZSgiRXJyb3IiKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICBkZWxldGVGaWxlc1Byb21pc2UudGhlbiggKG1lc3NhZ2UpPT4gewogICAgICAgICAgICBjb25zb2xlLmxvZyhtZXNzYWdlKQogICAgICAgICAgICBpZiAodGhpcy5mb2xkZXJzVG9EZWxldGUubGVuZ3RoKSB7CiAgICAgICAgICAgICAgZm9yIChsZXQgZm9sZGVyVG9EZWxldGUgPSAwOyBmb2xkZXJUb0RlbGV0ZSA8IHRoaXMuZm9sZGVyc1RvRGVsZXRlLmxlbmd0aDsgZm9sZGVyVG9EZWxldGUrKykgewogICAgICAgICAgICAgICAgdGhpcy5kZWxldGVGb2xkZXIodGhpcy5mb2xkZXJzVG9EZWxldGVbZm9sZGVyVG9EZWxldGVdKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmdldE9iamVjdHModGhpcy5leHBsb3JlckNvbmZpZy5wcmVmaXgpCiAgICAgICAgfQogICAgICApCiAgICB9LAogICAgZGVsZXRlRm9sZGVyKGZvbGRlcikgewogICAgICBjb25zdCBjb21wb25lbnQgPSB0aGlzCiAgICAgIGxldCBwYXJhbXMgPSB7CiAgICAgICAgQnVja2V0OiB0aGlzLmV4cGxvcmVyQ29uZmlnLmJ1Y2tldCwKICAgICAgICBQcmVmaXg6IGZvbGRlcgogICAgICB9CiAgICAgIGNvbXBvbmVudC5zMy5saXN0T2JqZWN0cyhwYXJhbXMsIGZ1bmN0aW9uKGVyciwgZGF0YSkgewogICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCJFcnJvciIsIGVycik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGZvbGRlckZpbGVzID0gZGF0YS5Db250ZW50cwogICAgICAgICAgY29tcG9uZW50LmZpbGVzVG9EZWxldGUgPSBbXQogICAgICAgICAgZm9yIChsZXQgaT0wOyBpIDwgZm9sZGVyRmlsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgbGV0IGZvbGRlckZpbGUgPSB7fQogICAgICAgICAgICBmb2xkZXJGaWxlLktleSA9IGZvbGRlckZpbGUuTmFtZSA9IGZvbGRlckZpbGVzW2ldLktleQogICAgICAgICAgICBjb21wb25lbnQuZmlsZXNUb0RlbGV0ZS5wdXNoKGZvbGRlckZpbGUpCiAgICAgICAgICB9CiAgICAgICAgICBjb21wb25lbnQuZGVsZXRlRmlsZXMoKQogICAgICAgIH0KICAgICAgfSkKICAgIH0sCiAgICBkZWxldGVGaWxlKGZpbGUpIHsKICAgICAgaWYgKHRoaXMuaXNGb2xkZXIoZmlsZSkpIHsKICAgICAgICB0aGlzLmZvbGRlcnNUb0RlbGV0ZS5wdXNoKGZpbGUuS2V5KQogICAgICB9CiAgICAgIGNvbnN0IGNvbXBvbmVudCA9IHRoaXMKICAgICAgbGV0IHBhcmFtcyA9IHsKICAgICAgICBCdWNrZXQ6IHRoaXMuZXhwbG9yZXJDb25maWcuYnVja2V0LAogICAgICAgIEtleTogZmlsZS5LZXkKICAgICAgfTsKICAgICAgdGhpcy5zMy5kZWxldGVPYmplY3QocGFyYW1zLCBmdW5jdGlvbihlcnIsIGRhdGEpIHsKICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygiRkFJTEVEIiwgZXJyLCBlcnIuc3RhY2spOyAvLyBhbiBlcnJvciBvY2N1cnJlZAogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgIGNvbXBvbmVudC4kcmVmc1snZGVsZXRlLW1vZGFsJ10uaGlkZSgpCiAgICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgICBjb21wb25lbnQuZ2V0T2JqZWN0cyhjb21wb25lbnQuZXhwbG9yZXJDb25maWcucHJlZml4KQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgczNUb1RhYmxlRGF0YSgpIHsKICAgICAgdGhpcy50YWJsZURhdGEgPSBbXQogICAgICBpZiAodGhpcy5zM09iamVjdHMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5mb2xkZXJFeGlzdHMgPSB0cnVlCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5mb2xkZXJFeGlzdHMgPSBmYWxzZQogICAgICB9CiAgICAgIGZvciAobGV0IGk9MDsgaSA8IHRoaXMuczNPYmplY3RzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgczNJdGVtID0gdGhpcy5zM09iamVjdHNbaV0KICAgICAgICBsZXQgaXRlbSA9IHt9CiAgICAgICAgbGV0IHB1c2ggPSBmYWxzZQogICAgICAgIGl0ZW0uTmFtZSA9IHMzSXRlbS5LZXkucmVwbGFjZSggbmV3IFJlZ0V4cChgXiR7dGhpcy5leHBsb3JlckNvbmZpZy5wcmVmaXh9YCksICIiKTsKICAgICAgICBpZiAoaXRlbS5OYW1lICE9PSAiIikgewogICAgICAgICAgLy8gRG9uJ3QgaW5jbHVkZSBibGFuayBuYW1lcyAodGhhdCdzIHRoZSBmb2xkZXIgd2UncmUgaW4gbm93KQogICAgICAgICAgY29uc3Qgc2xhc2hlcyA9IGl0ZW0uTmFtZS5zcGxpdCgiLyIpLmxlbmd0aCAtIDE7CiAgICAgICAgICBpZiAoc2xhc2hlcyA9PT0gMCkgewogICAgICAgICAgICAvLyBUaGlzIGlzIGEgZmlsZSBpbiB0aGlzIGZvbGRlciwgcHVzaCBpdCB0byB0aGUgaXRlbXMuCiAgICAgICAgICAgIHB1c2ggPSB0cnVlCiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc2xhc2hlcyA9PT0gMSkgewogICAgICAgICAgICAvLyBNaWdodCBiZSBhIGZvbGRlciwgb3IgY291bGQgYmUgYSBmaWxlIGluIGEgZGlmZmVyZW50IGZvbGRlcgogICAgICAgICAgICBpZiAodGhpcy5pc0ZvbGRlcihpdGVtKSkgewogICAgICAgICAgICAgIC8vIEZvbGRlciwgcHVzaCBpdCB0byBpdGVtcy4KICAgICAgICAgICAgICBwdXNoID0gdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocHVzaCkgewogICAgICAgICAgICBpdGVtLkxhc3RNb2RpZmllZCA9IHMzSXRlbS5MYXN0TW9kaWZpZWQKICAgICAgICAgICAgaXRlbS5TaXplID0gczNJdGVtLlNpemUKICAgICAgICAgICAgaXRlbS5LZXkgPSBzM0l0ZW0uS2V5CiAgICAgICAgICAgIGl0ZW0uc2VsZWN0ZWQgPSBmYWxzZQogICAgICAgICAgICBpdGVtLnR5cGUgPSB0aGlzLmdldEZpbGVUeXBlKGl0ZW0uTmFtZSkKICAgICAgICAgICAgdGhpcy50YWJsZURhdGEucHVzaChpdGVtKQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZQogICAgfSwKICAgIGdldEZpbGVUeXBlKGZpbGVOYW1lKSB7CiAgICAgIGNvbnN0IGZpbGVQYXJ0cyA9IGZpbGVOYW1lLnNwbGl0KCcuJykKICAgICAgaWYgKGZpbGVQYXJ0cy5sZW5ndGggPT09IDEpIHsKICAgICAgICByZXR1cm4gImZvbGRlciIKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmlsZVBhcnRzW2ZpbGVQYXJ0cy5sZW5ndGggLSAxXQogICAgICB9CiAgICB9LAogICAgaHVtYW5GaWxlU2l6ZShieXRlcywgc2k9dHJ1ZSwgZHA9MikgewogICAgICBpZiAoYnl0ZXMgPT09IDApIHsKICAgICAgICByZXR1cm4gJy0nCiAgICAgIH0KICAgICAgY29uc3QgdGhyZXNoID0gc2kgPyAxMDAwIDogMTAyNDsKCiAgICAgIGlmIChNYXRoLmFicyhieXRlcykgPCB0aHJlc2gpIHsKICAgICAgICByZXR1cm4gYnl0ZXMgKyAnIEInOwogICAgICB9CgogICAgICBjb25zdCB1bml0cyA9IHNpCiAgICAgICAgICA/IFsna0InLCAnTUInLCAnR0InLCAnVEInLCAnUEInLCAnRUInLCAnWkInLCAnWUInXQogICAgICAgICAgOiBbJ0tpQicsICdNaUInLCAnR2lCJywgJ1RpQicsICdQaUInLCAnRWlCJywgJ1ppQicsICdZaUInXTsKICAgICAgbGV0IHUgPSAtMTsKICAgICAgY29uc3QgciA9IDEwKipkcDsKCiAgICAgIGRvIHsKICAgICAgICBieXRlcyAvPSB0aHJlc2g7CiAgICAgICAgKyt1OwogICAgICB9IHdoaWxlIChNYXRoLnJvdW5kKE1hdGguYWJzKGJ5dGVzKSAqIHIpIC8gciA+PSB0aHJlc2ggJiYgdSA8IHVuaXRzLmxlbmd0aCAtIDEpOwoKCiAgICAgIHJldHVybiBieXRlcy50b0ZpeGVkKGRwKSArICcgJyArIHVuaXRzW3VdOwogICAgfSwKICAgIG5ld2VyVGhhbiAoZGF0ZSwgaG91cnMpIHsKICAgICAgY29uc3QgaG91cj0gMTAwMCAqIDYwICogNjA7CiAgICAgIHJldHVybiBkYXRlID4gRGF0ZS5ub3coKSAtIChob3VyICogaG91cnMpCiAgICB9LAogICAgaXNGb2xkZXIoaXRlbSkgewogICAgICByZXR1cm4gaXRlbS5OYW1lLnNsaWNlKC0xKSA9PT0gJy8nCiAgICB9LAogICAgbmV3Rm9sZGVyKCkgewogICAgICB0aGlzLiRyZWZzWydjcmVhdGUtZm9sZGVyLW1vZGFsJ10uaGlkZSgpCiAgICAgIHRoaXMubmV3Rm9sZGVyTmFtZSA9IHRoaXMubmV3Rm9sZGVyTmFtZS5yZXBsYWNlKC9cVysvZywgJy0nKS5yZXBsYWNlKC8tJC8sICcnKS50b0xvd2VyQ2FzZSgpOwogICAgICB0aGlzLmNyZWF0ZUZvbGRlcih0aGlzLm5ld0ZvbGRlck5hbWUpCiAgICAgIHRoaXMubmV3Rm9sZGVyTmFtZSA9ICIiCiAgICB9LAogICAgZ2V0T2JqZWN0cyhwcmVmaXgpIHsKICAgICAgY29uc3QgY29tcG9uZW50ID0gdGhpcwogICAgICB0aGlzLmV4cGxvcmVyQ29uZmlnLnByZWZpeCA9IHByZWZpeAogICAgICAvLyBDcmVhdGUgdGhlIHBhcmFtZXRlcnMgZm9yIGNhbGxpbmcgbGlzdE9iamVjdHMKICAgICAgbGV0IGJ1Y2tldFBhcmFtcyA9IHsKICAgICAgICBCdWNrZXQgOiB0aGlzLmV4cGxvcmVyQ29uZmlnLmJ1Y2tldCwKICAgICAgICBQcmVmaXg6IHByZWZpeAogICAgICB9OwoKICAgICAgLy8gQ2FsbCBTMyB0byBvYnRhaW4gYSBsaXN0IG9mIHRoZSBvYmplY3RzIGluIHRoZSBidWNrZXQKICAgICAgdGhpcy5zMy5saXN0T2JqZWN0cyhidWNrZXRQYXJhbXMsIGZ1bmN0aW9uKGVyciwgZGF0YSkgewogICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCJFcnJvciIsIGVycik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbXBvbmVudC5zM09iamVjdHMgPSBkYXRhLkNvbnRlbnRzCiAgICAgICAgICBjb21wb25lbnQuczNUb1RhYmxlRGF0YSgpCiAgICAgICAgICBjb21wb25lbnQuZ2V0QnJlYWRjcnVtYnMoKQogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgZ2V0QnJlYWRjcnVtYnMoKSB7CiAgICAgIGxldCBicmVhZGNydW1icyA9IFtdCiAgICAgIGxldCBrZXkgPSAiIgogICAgICBjb25zdCBwaWVjZXMgPSB0aGlzLmV4cGxvcmVyQ29uZmlnLnByZWZpeC5zcGxpdCgiLyIpCiAgICAgIGZvciAobGV0IGk9MDsgaSA8IHBpZWNlcy5sZW5ndGgtMTsgaSsrKSB7CiAgICAgICAga2V5ICs9IHBpZWNlc1tpXSArICIvIgogICAgICAgIGNvbnN0IGNydW1iID0gewogICAgICAgICAgbmFtZTogcGllY2VzW2ldLAogICAgICAgICAga2V5OiBrZXkKICAgICAgICB9CiAgICAgICAgYnJlYWRjcnVtYnMucHVzaChjcnVtYikKICAgICAgfQogICAgICB0aGlzLmJyZWFkY3J1bWJzID0gYnJlYWRjcnVtYnMKICAgIH0sCiAgICBhc3luYyB1cGxvYWRGaWxlcygpIHsKICAgICAgdGhpcy51cGxvYWRpbmcgPSB0cnVlCiAgICAgIHRoaXMudXBsb2FkZWQgPSBbXTsKICAgICAgdGhpcy5maWxlc1VwbG9hZGVkID0gMDsKICAgICAgY29uc3QgY29tcG9uZW50ID0gdGhpcwogICAgICBmb3IgKGxldCBpPTA7IGk8dGhpcy5maWxlc1RvVXBsb2FkLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgZmlsZSA9IHRoaXMuZmlsZXNUb1VwbG9hZFtpXQogICAgICAgIGNvbXBvbmVudC51cGxvYWRlZFtpXSA9IHsKICAgICAgICAgIG5hbWU6IGZpbGUubmFtZSwKICAgICAgICAgIHByb2dyZXNzOiAwLAogICAgICAgICAgbG9hZGVkOiAwLAogICAgICAgICAgdG90YWw6IGNvbXBvbmVudC5odW1hbkZpbGVTaXplKGZpbGUuc2l6ZSksCiAgICAgICAgICBzdGF0dXM6ICJ3YWl0aW5nIgogICAgICAgIH0KICAgICAgICBjb25zdCB1cGxvYWRQYXJhbXMgPSB7CiAgICAgICAgICBCdWNrZXQ6IHRoaXMuZXhwbG9yZXJDb25maWcuYnVja2V0LAogICAgICAgICAgS2V5OiAodGhpcy5leHBsb3JlckNvbmZpZy5wcmVmaXggfHwgJycpICsgKGZpbGUuZnVsbFBhdGggPyBmaWxlLmZ1bGxQYXRoIDogZmlsZS5uYW1lKSwKICAgICAgICAgIEJvZHk6IGZpbGUsCiAgICAgICAgICBDb250ZW50VHlwZTogZmlsZS50eXBlCiAgICAgICAgfTsKICAgICAgICBjb25zdCBvcHRpb25zID0ge3BhcnRTaXplOiA1ICogMTAyNCAqIDEwMjQsIHF1ZXVlU2l6ZTogMTB9OwogICAgICAgIHRoaXMuczMudXBsb2FkICh1cGxvYWRQYXJhbXMsIG9wdGlvbnMsIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHsKICAgICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coIkVycm9yIiwgZXJyKTsKICAgICAgICAgICAgY29tcG9uZW50LiRyZWZzWyd1cGxvYWQtbW9kYWwnXS5oaWRlKCkKICAgICAgICAgICAgYWxlcnQoJ1dlIGNvdWxkblwndCB1cGxvYWQgdGhpcyBmaWxlLicpCiAgICAgICAgICB9IGlmIChkYXRhKSB7CiAgICAgICAgICAgIC8vIEZpbGUgZnVsbHkgdXBsb2FkZWQKICAgICAgICAgICAgY29tcG9uZW50LnByb2dyZXNzQmFyS2V5ID0gY29tcG9uZW50LnJhbmRvbUtleSgpCiAgICAgICAgICAgIGNvbXBvbmVudC5maWxlc1VwbG9hZGVkKys7CiAgICAgICAgICAgIGlmIChjb21wb25lbnQuZmlsZXNVcGxvYWRlZCA9PT0gY29tcG9uZW50LmZpbGVzVG9VcGxvYWQubGVuZ3RoKSB7CiAgICAgICAgICAgICAgLy8gQUxMIEZJTEVTIFVQTE9BREVECiAgICAgICAgICAgICAgY29tcG9uZW50LiRyZWZzWyd1cGxvYWQtbW9kYWwnXS5oaWRlKCkKICAgICAgICAgICAgICBjb21wb25lbnQuZ2V0T2JqZWN0cyhjb21wb25lbnQuZXhwbG9yZXJDb25maWcucHJlZml4KQogICAgICAgICAgICAgIGNvbXBvbmVudC51cGxvYWRpbmcgPSBmYWxzZQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSkub24oJ2h0dHBVcGxvYWRQcm9ncmVzcycsIGZ1bmN0aW9uKHByb2dyZXNzKXsKICAgICAgICAgIC8vIHByb2dyZXNzIGFsc28gbGlzdHMga2V5IGV0YyBhbmQgc2l6ZQogICAgICAgICAgY29uc3QgcGVyY2VudFVwbG9hZGVkID0gcHJvZ3Jlc3MubG9hZGVkIC8gcHJvZ3Jlc3MudG90YWwgKiAxMDAKICAgICAgICAgIGlmIChwZXJjZW50VXBsb2FkZWQgPiBjb21wb25lbnQudXBsb2FkZWRbaV0ucHJvZ3Jlc3MpIHsKICAgICAgICAgICAgLy8gRG9uJ3QgcmVmcmVzaCB0aGUgcGFnZSBvbiBldmVyeSB0aWNrLCBpdCdsbCBjcmFzaCB0aGUgYnJvd3Nlci4KICAgICAgICAgICAgY29tcG9uZW50LnVwbG9hZGVkW2ldLnByb2dyZXNzID0gcGVyY2VudFVwbG9hZGVkCiAgICAgICAgICAgIGNvbXBvbmVudC51cGxvYWRlZFtpXS5sb2FkZWQgPSBjb21wb25lbnQuaHVtYW5GaWxlU2l6ZShwcm9ncmVzcy5sb2FkZWQpCiAgICAgICAgICAgIGNvbXBvbmVudC51cGxvYWRlZFtpXS50b3RhbCA9IGNvbXBvbmVudC5odW1hbkZpbGVTaXplKHByb2dyZXNzLnRvdGFsKQogICAgICAgICAgICBjb21wb25lbnQucHJvZ3Jlc3NCYXJLZXkgPSBjb21wb25lbnQucmFuZG9tS2V5KCkKICAgICAgICAgIH0KICAgICAgICAgIGlmIChwcm9ncmVzcy50b3RhbCA+IHByb2dyZXNzLmxvYWRlZCkgewogICAgICAgICAgICBjb21wb25lbnQudXBsb2FkZWRbaV0uc3RhdHVzID0gJ3VwbG9hZGluZycKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbXBvbmVudC51cGxvYWRlZFtpXS5zdGF0dXMgPSAnY29tcGxldGUnCiAgICAgICAgICB9CiAgICAgICAgICBjb25zb2xlLmxvZyhwcm9ncmVzcykKICAgICAgICB9KTsKCiAgICAgIH0KICAgIH0sCiAgICBjcmVhdGVGb2xkZXIoZm9sZGVyKSB7CiAgICAgIGNvbnN0IGtleSA9IHRoaXMuZXhwbG9yZXJDb25maWcucHJlZml4ICsgZm9sZGVyICsgJy8nCiAgICAgIGNvbnN0IGNvbXBvbmVudCA9IHRoaXMKICAgICAgY29uc3QgdXBsb2FkUGFyYW1zID0gewogICAgICAgIEJ1Y2tldDogdGhpcy5leHBsb3JlckNvbmZpZy5idWNrZXQsCiAgICAgICAgS2V5OiBrZXksCiAgICAgICAgQm9keTogJycsCiAgICAgICAgQUNMOiAicHJpdmF0ZSIKICAgICAgfTsKICAgICAgdGhpcy5zMy51cGxvYWQgKHVwbG9hZFBhcmFtcywgZnVuY3Rpb24gKGVyciwgZGF0YSkgewogICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCJFcnJvciIsIGVycik7CiAgICAgICAgfSBpZiAoZGF0YSkgewogICAgICAgICAgY29tcG9uZW50LmdldE9iamVjdHMoY29tcG9uZW50LmV4cGxvcmVyQ29uZmlnLnByZWZpeCkKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0sCn0K"},{"version":3,"sources":["FileExplorer.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2HA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"FileExplorer.vue","sourceRoot":"src/components/dashboard/aws","sourcesContent":["<template>\n  <div>\n    <div v-if=\"!environmentError\">\n      <ul class=\"action_icons\" v-if=\"folderExists\">\n        <li style=\"right:8rem\"><font-awesome-icon class=\"filter\" icon=\"filter\" /><input v-model=\"filter\" /></li>\n        <li id=\"button_refresh\" style=\"right:8rem; font-size: .8em; top:0.125em\">\n          <a href=\"#\" @click.prevent=\"refresh\"><font-awesome-icon icon=\"redo-alt\" /></a>\n        </li>\n        <li id=\"button_create_folder\" style=\"right:6rem\">\n          <a href=\"#\" @click.prevent=\"showNewFolderModal\"><font-awesome-icon icon=\"folder-plus\" /></a>\n        </li>\n        <li id=\"button_upload_file\" style=\"right:4rem; font-size: .9em\">\n          <a href=\"#\" @click.prevent=\"showUploadModal\"><font-awesome-icon icon=\"file-upload\" /></a>\n        </li>\n        <li id=\"button_delete\" style=\"right:2rem; font-size: .8em;\">\n          <a href=\"#\" @click.prevent=\"showDeleteModal\"><font-awesome-icon alt=\"Delete selected files\" icon=\"trash\" /></a>\n        </li>\n      </ul>\n      <b-tabs>\n        <b-tab :title=\"$t('AWS-Datei-Explorer')\" >\n          <b-card>\n            <ul class=\"breadcrumb\" >\n              <li\n                  @click=\"openFolder(breadcrumb.key)\"\n                  :class=\"breadcrumbClass\"\n                  :key=\"`breadcrumb_${breadcrumb.name}`\"\n                  v-for=\"breadcrumb in breadcrumbs\">\n                <span v-if=\"isHome(breadcrumb.name)\">{{$t(\"Hauptseite\")}}</span>\n                <span v-else-if=\"folderExists\">{{breadcrumb.name}}</span>\n              </li>\n            </ul>\n            <Loading v-if=\"loading\" />\n            <div v-else>\n              <b-table\n                  v-if=\"folderExists\"\n                  show-empty\n                  id=\"fileExplorerTable\"\n                  :items=\"tableData\"\n                  :fields=\"explorerConfig.fields\"\n                  :filter=\"filter\"\n                  empty-text=\"There are no items in this folder.\"\n                  :per-page=\"perPage\"\n                  :current-page=\"currentPage\"\n              >\n                <template v-slot:cell(selected)=\"data\">\n                  <b-form-checkbox v-model=\"data.item.selected\"/>\n                </template>\n                <template v-slot:cell(type)=\"data\">\n                  <font-awesome-icon class=\"file-type\" :icon=\"data.value\" />\n                </template>\n                <template v-slot:cell(Name)=\"data\">\n                  <a href=\"#\" @click.prevent=\"openObject(data.item, $event)\">\n                    {{ data.item.Name.replace('/', '') }}\n                  </a>\n                </template>\n              </b-table>\n              <p v-else>404. This folder does not exist.</p>\n              <b-pagination\n                  v-if=\"rows > perPage\"\n                  v-model=\"currentPage\"\n                  :total-rows=\"rows\"\n                  :per-page=\"perPage\"\n                  aria-controls=\"fileExplorerTable\"\n              ></b-pagination>\n            </div>\n          </b-card>\n        </b-tab>\n      </b-tabs>\n      <b-modal ref=\"upload-modal\" hide-footer title=\"Upload a file to S3\" size=\"lg\">\n        <b-form id=\"uploadForm\" @submit.prevent=\"uploadFiles\" v-if=\"!uploading\">\n          <b-form-file\n              v-model=\"filesToUpload\"\n              :state=\"Boolean(filesToUpload)\"\n              placeholder=\"Browse to files or drag and drop here.\"\n              drop-placeholder=\"Drag and drop files here.\"\n              name=\"files_to_upload\"\n              multiple\n          ></b-form-file>\n          <b-button class=\"upload-button\" type=\"submit\" variant=\"primary\" :disabled=\"!filesToUpload.length\">Submit</b-button>\n        </b-form>\n        <div style=\"padding:1em\" id=\"progress-bar\" :key=\"progressBarKey\" v-else>\n          <b-table :items=\"uploaded\" :fields=\"uploadedFields\" striped outlined thead-class=\"d-none\" >\n            <template v-slot:cell(progress)=\"data\">\n              <div class=\"s3-progress-bar\">\n                <div class=\"numbers\">{{data.item.loaded}} / {{data.item.total}}</div>\n                <div class=\"fill\" :style=\"`width:${data.item.progress}%`\"></div>\n              </div>\n            </template>\n            <template v-slot:cell(status)=\"data\">\n              <font-awesome-icon v-if=\"data.item.status==='waiting'\" class=\"status-icon waiting\" icon=\"ellipsis-h\" />\n              <font-awesome-icon v-if=\"data.item.status==='uploading'\" class=\"status-icon uploading\" icon=\"arrow-alt-circle-up\" />\n              <font-awesome-icon v-if=\"data.item.status==='complete'\" class=\"status-icon complete\" icon=\"check-circle\" />\n            </template>\n          </b-table>\n        </div>\n      </b-modal>\n      <b-modal ref=\"create-folder-modal\" hide-footer title=\"Create a folder\">\n        <b-form @submit.prevent=\"newFolder\">\n          <b-form-input v-model=\"newFolderName\" name=\"newFolder\" />\n          <b-button :disabled=\"!newFolderName\" class=\"upload-button\" type=\"submit\" variant=\"primary\">Submit</b-button>\n        </b-form>\n      </b-modal>\n      <b-modal ref=\"delete-modal\" hide-footer title=\"Confirm you want to delete the following items\">\n        <p>If you delete folders, you will also delete any subfolders and items they contain.</p>\n        <b-form @submit.prevent=\"deleteFiles\">\n          <ul v-if=\"filesToDelete.length\">\n            <li :key=\"`file_to_delete_${index}`\" v-for=\"(file, index) in filesToDelete\">{{file.Name}}</li>\n          </ul>\n          <p v-else>No files are selected.</p>\n          <b-button :disabled=\"!filesToDelete.length\" class=\"upload-button\" type=\"submit\" variant=\"danger\">Delete</b-button>\n        </b-form>\n      </b-modal>\n    </div>\n    <div v-else>\n      <p>\n        AWS File Explorer isn't available right now. It should be back online soon!\n      </p>\n    </div>\n  </div>\n</template>\n\n<script>\n\nimport moment from \"moment-timezone\"\nimport Loading from \"@/components/Loading\";\n\nexport default {\n  name: \"FileExplorer\",\n  components: {Loading},\n  mounted() {\n    if (!this.environmentError) {\n      this.aws.config.update(\n          {\n            region: this.explorerConfig.region,\n            accessKeyId: this.explorerConfig.accessKey,\n            secretAccessKey: this.explorerConfig.secretKey,\n            correctClockSkew: true,\n            signatureVersion: 'v4'\n          }\n      );\n      this.s3 = new this.aws.S3({apiVersion: this.explorerConfig.api});\n      this.updateExplorerFromRoute()\n    } else {\n      console.log(\"Environment error: Are your environment variables set up correctly?\")\n    }\n\n  },\n  data() {\n    try {\n      return {\n        aws: require('aws-sdk'),\n        currentPage:1,\n        perPage:25,\n        uploaded: [],\n        filesUploaded: 0,\n        loading: true,\n        progressBarKey: this.randomKey(),\n        uploadedFields: [\n          'name',\n          'progress',\n          'status'\n        ],\n        folderExists: false,\n        uploading: false,\n        explorerConfig: {\n          accessKey: process.env.VUE_APP_S3_ACCESS_KEY,\n          secretKey: process.env.VUE_APP_S3_SECRET_KEY,\n          prefix: process.env.VUE_APP_S3_DEFAULT_FOLDER,\n          home: process.env.VUE_APP_S3_DEFAULT_FOLDER.replace('/', ''),\n          bucket: process.env.VUE_APP_S3_BUCKET,\n          region: process.env.VUE_APP_S3_REGION,\n          api: process.env.VUE_APP_S3_API_VERSION,\n          fields: [\n            'selected',\n            {\n              key: 'type',\n              sortable: true,\n              sortByFormatted: true,\n              formatter: (value) => {\n                const fileType = value.toLowerCase()\n                let icon\n                switch (fileType) {\n                    // Folder\n                  case 'folder':\n                    icon = 'folder-open'\n                    break;\n                    //  Audio formats\n                  case 'm4a':\n                  case 'flac':\n                  case 'mp3':\n                  case 'wav':\n                  case 'wma':\n                  case 'aac':\n                    icon = 'file-audio'\n                    break\n                    //  Video formats\n                  case 'mp4':\n                  case 'mov':\n                  case 'wmv':\n                  case 'avi':\n                  case 'avchd':\n                  case 'flv':\n                  case 'f4v':\n                  case 'swf':\n                  case 'webm':\n                  case 'mpeg-2':\n                    icon = 'file-video'\n                    break\n                    // Archive formats\n                  case 'zip':\n                  case 'rar':\n                  case 'gz':\n                  case '7z':\n                    icon = 'file-archive'\n                    break\n                    // Image formats\n                  case 'gif':\n                  case 'jpg':\n                  case 'jpeg':\n                  case 'svg':\n                  case 'bmp':\n                  case 'png':\n                  case 'psd':\n                  case 'ai':\n                    icon = 'file-image'\n                    break\n                    // Excel\n                  case 'xls':\n                  case 'xlsx':\n                    icon = 'file-excel'\n                    break\n                    // Word\n                  case 'doc':\n                  case 'docx':\n                    icon = 'file-word'\n                    break\n                    // Powerpoint\n                  case 'ppt':\n                  case 'pptx':\n                    icon = 'file-powerpoint'\n                    break\n                    // CSV\n                  case 'csv':\n                    icon = 'file-csv'\n                    break\n                    // PDF\n                  case 'pdf':\n                    icon = 'file-pdf'\n                    break\n                    // Text file\n                  case 'txt':\n                    icon = 'file-alt'\n                    break\n                    // If no match default to a blank file icon\n                  default:\n                    icon = 'file'\n                }\n                return icon\n              }\n            },\n            {\n              key: 'Name',\n              sortable: true,\n              tdClass: 'text-left'\n            },\n            {\n              key: 'LastModified',\n              sortable: true,\n              formatter: (value) => {\n                return moment(value).tz(this.timeZone).format(\"DD/MM/YYYY HH:mm:ss\")\n              }\n            },\n            {\n              key: 'Size',\n              sortable: true,\n              formatter: (value) => {\n                return this.humanFileSize(value)\n              },\n            },\n          ]\n        },\n        timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,\n        s3Objects: [],\n        s3: null,\n        tableData: [],\n        breadcrumbs: [],\n        newFolderName: \"\",\n        filesToDelete: [],\n        filesToUpload: [],\n        foldersToDelete: [],\n        filter: \"\",\n        downloaded: 0,\n        breadcrumbKey: this.randomKey(),\n        environmentError: false\n      }\n    }\n    catch {\n      return {\n        environmentError: true\n      }\n    }\n  },\n  computed: {\n    rows() {\n      return this.tableData.length\n    },\n    breadcrumbClass() {\n      if (this.folderExists) {\n        return \"breadcrumb-item\"\n      }\n      return \"\"\n    }\n  },\n  watch: {\n    $route() {\n      this.updateExplorerFromRoute()\n    }\n  },\n  methods: {\n    refresh() {\n      this.getObjects(this.explorerConfig.prefix)\n    },\n    updateExplorerFromRoute() {\n      let folderPath = this.$route.path.replace('/aws','')\n      let fullPath = this.explorerConfig.home  + folderPath\n      if (fullPath.substr(-1) != \"/\") {\n        fullPath+=\"/\"\n      }\n      this.explorerConfig.prefix = fullPath\n      this.getObjects(this.explorerConfig.prefix)\n    },\n    isHome(breadcrumb) {\n      return breadcrumb === this.explorerConfig.home\n    },\n    randomKey(min = 1, max = 1000) { // min and max included\n      return Math.floor(Math.random() * (max - min + 1) + min)\n    },\n    showDeleteModal() {\n      this.filesToDelete = []\n      for (let i=0; i<this.tableData.length; i++) {\n        const currentItem = this.tableData[i]\n        if (currentItem.selected) {\n          this.filesToDelete.push(currentItem)\n        }\n      }\n      this.$refs['delete-modal'].show()\n    },\n    showUploadModal() {\n      this.filesToUpload = []\n      this.$refs['upload-modal'].show()\n    },\n    showNewFolderModal() {\n      this.filesToUpload = []\n      this.$refs['create-folder-modal'].show()\n    },\n    openObject(item, event) {\n      if(this.isFolder(item)) {\n        this.openFolder(item.Key)\n      } else {\n        const placeholder = event.target\n        const downloadInformation = document.createElement('div')\n        downloadInformation.innerHTML = \"Preparing download of \" + event.target.text + \"<span>(0/0)</span>\"\n        event.target.replaceWith(downloadInformation)\n        this.openFile(item, placeholder, downloadInformation)\n      }\n    },\n    openFolder(folder) {\n      const newRoute = folder.replace(this.explorerConfig.home, '/aws')\n      this.$router.push(newRoute);\n    },\n    openFile(item, placeholder, downloadInformation) {\n      const tracker = downloadInformation.getElementsByTagName('span')[0]\n      const component = this\n      tracker.innerHTML = `(0/${component.humanFileSize(item.Size)})`\n      this.s3.getObject(\n          { Bucket: component.explorerConfig.bucket, Key: item.Key },\n          function (error, data) {\n            if (error != null) {\n              console.log(error)\n            } else {\n              const blob = new Blob([data.Body], {type: `${data.ContentType}`})\n              const fileURL = window.URL.createObjectURL(blob);\n              const fileLink = document.createElement('a');\n              fileLink.text = \"Download again\"\n              fileLink.href = fileURL;\n              fileLink.setAttribute('download', item.Name);\n              document.body.appendChild(fileLink);\n              downloadInformation.replaceWith(placeholder)\n              downloadInformation.appendChild(fileLink)\n              fileLink.click();\n            }\n          }\n      ).on('httpDownloadProgress', function(progress){\n        console.log(progress)\n        tracker.innerHTML = `(${component.humanFileSize(progress.loaded)}/${component.humanFileSize(progress.total)})`\n      });\n    },\n    deleteFiles() {\n      const component = this\n      let deleteFilesPromise = new Promise(function(resolveDelete, rejectDelete) {\n        let deletedFiles\n        let numberOfFiles = component.filesToDelete.length\n        component.foldersToDelete = []\n        for(deletedFiles=0; deletedFiles<numberOfFiles; deletedFiles++) {\n          component.deleteFile(component.filesToDelete[deletedFiles])\n        }\n        if (deletedFiles === numberOfFiles) {\n          resolveDelete(numberOfFiles + \" files deleted\");\n        } else {\n          rejectDelete(\"Error\");\n        }\n      });\n      deleteFilesPromise.then( (message)=> {\n            console.log(message)\n            if (this.foldersToDelete.length) {\n              for (let folderToDelete = 0; folderToDelete < this.foldersToDelete.length; folderToDelete++) {\n                this.deleteFolder(this.foldersToDelete[folderToDelete])\n              }\n            }\n            this.getObjects(this.explorerConfig.prefix)\n        }\n      )\n    },\n    deleteFolder(folder) {\n      const component = this\n      let params = {\n        Bucket: this.explorerConfig.bucket,\n        Prefix: folder\n      }\n      component.s3.listObjects(params, function(err, data) {\n        if (err) {\n          console.log(\"Error\", err);\n        } else {\n          const folderFiles = data.Contents\n          component.filesToDelete = []\n          for (let i=0; i < folderFiles.length; i++) {\n            let folderFile = {}\n            folderFile.Key = folderFile.Name = folderFiles[i].Key\n            component.filesToDelete.push(folderFile)\n          }\n          component.deleteFiles()\n        }\n      })\n    },\n    deleteFile(file) {\n      if (this.isFolder(file)) {\n        this.foldersToDelete.push(file.Key)\n      }\n      const component = this\n      let params = {\n        Bucket: this.explorerConfig.bucket,\n        Key: file.Key\n      };\n      this.s3.deleteObject(params, function(err, data) {\n        if (err) {\n          console.log(\"FAILED\", err, err.stack); // an error occurred\n        }\n        else {\n          component.$refs['delete-modal'].hide()\n          if (data) {\n            component.getObjects(component.explorerConfig.prefix)\n          }\n        }\n      });\n    },\n    s3ToTableData() {\n      this.tableData = []\n      if (this.s3Objects.length) {\n        this.folderExists = true\n      } else {\n        this.folderExists = false\n      }\n      for (let i=0; i < this.s3Objects.length; i++) {\n        const s3Item = this.s3Objects[i]\n        let item = {}\n        let push = false\n        item.Name = s3Item.Key.replace( new RegExp(`^${this.explorerConfig.prefix}`), \"\");\n        if (item.Name !== \"\") {\n          // Don't include blank names (that's the folder we're in now)\n          const slashes = item.Name.split(\"/\").length - 1;\n          if (slashes === 0) {\n            // This is a file in this folder, push it to the items.\n            push = true\n          }\n          if (slashes === 1) {\n            // Might be a folder, or could be a file in a different folder\n            if (this.isFolder(item)) {\n              // Folder, push it to items.\n              push = true\n            }\n          }\n          if (push) {\n            item.LastModified = s3Item.LastModified\n            item.Size = s3Item.Size\n            item.Key = s3Item.Key\n            item.selected = false\n            item.type = this.getFileType(item.Name)\n            this.tableData.push(item)\n          }\n        }\n      }\n      this.loading = false\n    },\n    getFileType(fileName) {\n      const fileParts = fileName.split('.')\n      if (fileParts.length === 1) {\n        return \"folder\"\n      } else {\n        return fileParts[fileParts.length - 1]\n      }\n    },\n    humanFileSize(bytes, si=true, dp=2) {\n      if (bytes === 0) {\n        return '-'\n      }\n      const thresh = si ? 1000 : 1024;\n\n      if (Math.abs(bytes) < thresh) {\n        return bytes + ' B';\n      }\n\n      const units = si\n          ? ['kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']\n          : ['KiB', 'MiB', 'GiB', 'TiB', 'PiB', 'EiB', 'ZiB', 'YiB'];\n      let u = -1;\n      const r = 10**dp;\n\n      do {\n        bytes /= thresh;\n        ++u;\n      } while (Math.round(Math.abs(bytes) * r) / r >= thresh && u < units.length - 1);\n\n\n      return bytes.toFixed(dp) + ' ' + units[u];\n    },\n    newerThan (date, hours) {\n      const hour= 1000 * 60 * 60;\n      return date > Date.now() - (hour * hours)\n    },\n    isFolder(item) {\n      return item.Name.slice(-1) === '/'\n    },\n    newFolder() {\n      this.$refs['create-folder-modal'].hide()\n      this.newFolderName = this.newFolderName.replace(/\\W+/g, '-').replace(/-$/, '').toLowerCase();\n      this.createFolder(this.newFolderName)\n      this.newFolderName = \"\"\n    },\n    getObjects(prefix) {\n      const component = this\n      this.explorerConfig.prefix = prefix\n      // Create the parameters for calling listObjects\n      let bucketParams = {\n        Bucket : this.explorerConfig.bucket,\n        Prefix: prefix\n      };\n\n      // Call S3 to obtain a list of the objects in the bucket\n      this.s3.listObjects(bucketParams, function(err, data) {\n        if (err) {\n          console.log(\"Error\", err);\n        } else {\n          component.s3Objects = data.Contents\n          component.s3ToTableData()\n          component.getBreadcrumbs()\n        }\n      });\n    },\n    getBreadcrumbs() {\n      let breadcrumbs = []\n      let key = \"\"\n      const pieces = this.explorerConfig.prefix.split(\"/\")\n      for (let i=0; i < pieces.length-1; i++) {\n        key += pieces[i] + \"/\"\n        const crumb = {\n          name: pieces[i],\n          key: key\n        }\n        breadcrumbs.push(crumb)\n      }\n      this.breadcrumbs = breadcrumbs\n    },\n    async uploadFiles() {\n      this.uploading = true\n      this.uploaded = [];\n      this.filesUploaded = 0;\n      const component = this\n      for (let i=0; i<this.filesToUpload.length; i++) {\n        const file = this.filesToUpload[i]\n        component.uploaded[i] = {\n          name: file.name,\n          progress: 0,\n          loaded: 0,\n          total: component.humanFileSize(file.size),\n          status: \"waiting\"\n        }\n        const uploadParams = {\n          Bucket: this.explorerConfig.bucket,\n          Key: (this.explorerConfig.prefix || '') + (file.fullPath ? file.fullPath : file.name),\n          Body: file,\n          ContentType: file.type\n        };\n        const options = {partSize: 5 * 1024 * 1024, queueSize: 10};\n        this.s3.upload (uploadParams, options, function (err, data) {\n          if (err) {\n            console.log(\"Error\", err);\n            component.$refs['upload-modal'].hide()\n            alert('We couldn\\'t upload this file.')\n          } if (data) {\n            // File fully uploaded\n            component.progressBarKey = component.randomKey()\n            component.filesUploaded++;\n            if (component.filesUploaded === component.filesToUpload.length) {\n              // ALL FILES UPLOADED\n              component.$refs['upload-modal'].hide()\n              component.getObjects(component.explorerConfig.prefix)\n              component.uploading = false\n            }\n          }\n        }).on('httpUploadProgress', function(progress){\n          // progress also lists key etc and size\n          const percentUploaded = progress.loaded / progress.total * 100\n          if (percentUploaded > component.uploaded[i].progress) {\n            // Don't refresh the page on every tick, it'll crash the browser.\n            component.uploaded[i].progress = percentUploaded\n            component.uploaded[i].loaded = component.humanFileSize(progress.loaded)\n            component.uploaded[i].total = component.humanFileSize(progress.total)\n            component.progressBarKey = component.randomKey()\n          }\n          if (progress.total > progress.loaded) {\n            component.uploaded[i].status = 'uploading'\n          } else {\n            component.uploaded[i].status = 'complete'\n          }\n          console.log(progress)\n        });\n\n      }\n    },\n    createFolder(folder) {\n      const key = this.explorerConfig.prefix + folder + '/'\n      const component = this\n      const uploadParams = {\n        Bucket: this.explorerConfig.bucket,\n        Key: key,\n        Body: '',\n        ACL: \"private\"\n      };\n      this.s3.upload (uploadParams, function (err, data) {\n        if (err) {\n          console.log(\"Error\", err);\n        } if (data) {\n          component.getObjects(component.explorerConfig.prefix)\n        }\n      });\n    }\n  },\n}\n</script>\n\n<style lang=\"scss\">\n\n.action_icons {\n  list-style: none;\n  display: inline-block;\n  position: absolute;\n  right:2em;\n  li {\n    display: inline-block;\n    position: absolute;\n    .filter {\n      position: absolute;\n      top:.25em;\n      color: rgb(200, 200, 200);\n      margin-left: -1.5em;\n    }\n    input {\n      margin-right:1em;\n      margin-top:-1em;\n      width:15em;\n      padding: 0 .5em;\n    }\n    a {\n      color: rgba(90,90,90,1);\n      &:hover {\n        color: #990000\n      }\n      svg {\n        position: absolute;\n        height:1.5em !important;\n        width:1.5em !important;\n        margin-right: .5em;\n      }\n    }\n  }\n}\n\n.upload-button {\n  margin-top:1em;\n  font-size: .9em !important;\n}\n.modal-header h5 {\n  font-size: 1em;\n}\n\n.modal-dialog {\n  font-size: .9em;\n  placeholder {\n    font-size: .9em !important;\n  }\n}\n\n#fileExplorerTable {\n  th {\n    &:nth-of-type(1), &:nth-of-type(2) {\n      width: 2em;\n    }\n    &:nth-of-type(4), &:nth-of-type(5) {\n      width: 12em;\n    }\n  }\n}\n\n.modal-header h5 {\n  font-size: 1em;\n}\n\n.status-icon {\n  height:1em; width:1em;\n  &.complete {\n    color: rgba(40,120,40, .8);\n  }\n  &.uploading, &.waiting {\n    color: rgba(40,40,40, .4);\n  }\n\n}\n\n.folder-icon {\n  margin-right:1em\n}\n\n.s3-progress-bar {\n  width: 15em;\n  height:1.5em;\n  z-index: 4;\n  border: 1px solid rgba(40,120,40, .5);\n  border-radius: .125em;\n  .fill {\n    background: rgb(140,220,140);\n    height:1.375em;\n    z-index: 3;\n    border-radius: .125em;\n    transition: width .1s ease-in-out;\n  }\n  .numbers {\n    position: absolute;\n    width:15em;\n    text-align: center;\n  }\n}\n.text-left {\n  padding-left:1em !important;\n}\n.file-type {\n  font-size: 24px;\n  color: #5a5a5a;\n}\n\n.breadcrumb {\n  border-radius: .25em !important;\n  margin-bottom: 2em !important;\n}\n\n.breadcrumb-item {\n  cursor: pointer;\n  color: #cc0000;\n  text-decoration: underline;\n\n  &:hover {\n    color: #2b2b2b;\n  }\n\n  &:last-child {\n    cursor: default;\n    color: inherit;\n    text-decoration: none;\n  }\n}\n\n.inactive {\n  font-weight: bold;\n\n  &:after {\n    content: \":\";\n    display: inline-block;\n    width: 1em;\n  }\n}\n\n.disabled {\n  &.btn-primary, &.btn-danger {\n    color: rgba(255,255,255,.5) !important;\n  }\n}\n\n\n</style>\n"]}]}